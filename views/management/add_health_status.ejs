<style>
    .form-disabled{
        border: 1px solid red;
    }
</style>
<div id="add_health_status" style="display: none;">
    <div class="row">
        <div class="col-6">
            <div class="row">
                <div class="col-6">
                    <div class="block">
                        <el-date-picker
                        class="w-100"
                        v-model="form.caringTime"
                        type="datetime"
                        placeholder="電話關懷時間">
                        </el-date-picker>
                    </div>
                </div>
                <div class="col-6">
                    <input type="text" placeholder="體溫" class="form-control" :class="{ 'form-disabled': !checkJustNumber }" v-model="form.temperature" >
                </div>
            </div>
            <hr>
            <div class="row">
                <div class="col-12">
                    <div>
                        疑似症狀：（可複選）
                        <br><br>
                        <div class="container">
                            <div class="row">
                                <el-checkbox-group v-model="form.checkboxGroup1" size="small" style="margin-top: 3px;">
                                    <template v-for="(item, index) in types">
                                        <template v-if="index == 0">
                                            <el-checkbox  :label="item.type_name" class='col-3' style="margin-left: 10px;" border size="medium"></el-checkbox>
                                        </template>
                                        <template v-else>
                                        <el-checkbox  :label="item.type_name" class='col-3' border size="medium"></el-checkbox>
                                        </template>
                                    </template>
                                </el-checkbox-group>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <hr>
            <div class="row">
                <div class="col-12">
                    <el-input type="textarea"  :rows="5"  placeholder="備註事項" v-model="form.note"></el-input>
                </div>
            </div>
        </div>
        <div class="col-6">
            *** 該民眾歷次紀錄顯示區(尚未完工) ***
        </div>
    </div>
</div>

<script>
    new Vue({
        el: "#add_health_status",
        data: {
            form: {
                temperature: '',
                checkboxGroup1:[],
                note: '',
                caringTime: ''
            },
            types: [],
            allowNumberChars: ["1", "2", "3", "4", "5", "6", "7", "8", "9", "0", "."],
        },
        created() {
           let vm=this;
           vm.getAllSymptomType();
        },
        methods: {
            checkJustNumberAndDot(value){
                //若為空
                if (value.length <=0) 
                    return false;
                //若第一個或最後一個為.
                if (value[0] === '.' || value[value.length -1 ] === '.' ){
                    return false;
                }
                let dotCount = 0;
                for( let i = 0; i < value.length; i++ ){
                    if ( !this.allowNumberChars.includes(value[i]) ){
                        return false;
                    }
                    if ( value[i] == '.' ){
                        dotCount++;
                    }
                }
                if (dotCount > 1){
                    return false;
                }
                return true;
            },
            getAllSymptomType(){
                let vm = this;
                axios.get('/management/get_all_symptom_types')
                .then((res) => {
                    vm.types = res.data;
                })
            },
            getQueryStringValue (key) {  
                return decodeURIComponent(window.location.search.replace(new RegExp("^(?:.*[&\\?]" + encodeURIComponent(key).replace(/[\.\+\*]/g, "\\$&") + "(?:\\=([^&]*))?)?.*$", "i"), "$1"));  
            }
        },
        computed: {
            checkJustNumber(){
                let vm = this;
                value = vm.form.temperature.split('');
                return vm.checkJustNumberAndDot(value);
            },
        }
    })
</script>